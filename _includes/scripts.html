<script src="{{ '/assets/js/bootstrap.min.js'  | relative_url }}"></script>
<script>
    /* Initialize carousels */
    var myCarousel = document.getElementById('myCarousel');
    var carouselThumbs = document.getElementById('carousel-thumbs');
    if (myCarousel) {
        new bootstrap.Carousel(myCarousel, { interval: false });
    }
    if (carouselThumbs) {
        new bootstrap.Carousel(carouselThumbs, { interval: false });
    }

    /* Handle carousel thumbnails */
    /* https://stackoverflow.com/questions/25752187/bootstrap-carousel-with-thumbnails-multiple-carousel */
    document.querySelectorAll('[id^=carousel-selector-]').forEach(function (el) {
        el.addEventListener('click', function () {
            var id_selector = el.id;
            var id = parseInt(id_selector.substring(id_selector.lastIndexOf('-') + 1), 10);
            if (myCarousel) {
                var carouselInstance = bootstrap.Carousel.getInstance(myCarousel);
                if (carouselInstance) carouselInstance.to(id);
            }
        });
    });

    /* Only display 3 items in nav on mobile */
    if (window.innerWidth < 575) {
        document.querySelectorAll('#carousel-thumbs .row div:nth-child(4)').forEach(function (rowBoundary) {
            var parentRow = rowBoundary.parentElement;
            var newRow = document.createElement('div');
            newRow.className = 'row mx-0';
            parentRow.parentElement.insertBefore(newRow, parentRow.nextSibling);
            /* Move all siblings after rowBoundary (including itself) into newRow */
            var moveNodes = [];
            var node = rowBoundary;
            while (node) {
                moveNodes.push(node);
                node = node.nextElementSibling;
            }
            moveNodes.forEach(function (n) { newRow.appendChild(n); });
        });
        document.querySelectorAll('#carousel-thumbs .carousel-item .row:nth-child(even)').forEach(function (boundary) {
            var parentItem = boundary.parentElement;
            var newItem = document.createElement('div');
            newItem.className = 'carousel-item';
            parentItem.parentElement.insertBefore(newItem, parentItem.nextSibling);
            /* Move all siblings after boundary (including itself) into newItem */
            var moveNodes = [];
            var node = boundary;
            while (node) {
                moveNodes.push(node);
                node = node.nextElementSibling;
            }
            moveNodes.forEach(function (n) { newItem.appendChild(n); });
        });
    }

    /* Hide slide arrows if too few items */
    if (document.querySelectorAll('#carousel-thumbs .carousel-item').length < 2) {
        document.querySelectorAll('#carousel-thumbs [class^=carousel-control-]').forEach(function (el) {
            el.remove();
        });
        var thumbs = document.querySelector('.machine-carousel-container #carousel-thumbs');
        if (thumbs) thumbs.style.padding = '0 5px';
    }

    /* When the carousel slides, auto update */
    if (myCarousel) {
        myCarousel.addEventListener('slide.bs.carousel', function (e) {
            var id = parseInt(e.relatedTarget.getAttribute('data-slide-number'), 10);
            document.querySelectorAll('[id^=carousel-selector-]').forEach(function (el) {
                el.classList.remove('selected');
            });
            var selected = document.getElementById('carousel-selector-' + id);
            if (selected) selected.classList.add('selected');
        });
    }
</script>